<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Manak: Complete guide on Parametrized Benchmarking</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Manak
   &#160;<span id="projectnumber">2.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('p_bench.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Complete guide on Parametrized Benchmarking </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>With the use of advance C++11 features, Manak implements simple to use parametrized benchmarking. Parametrized benchmarking is useful when a same function is benchmarkek with many different parameters.</p>
<div class="fragment"><div class="line"><a class="code" href="module__benchmark__case_8hpp.html#a57b66a0d95282c208124d1bdac0f8d2e">MANAK_AUTO_BENCHMARK_CASE</a>(ForLoops_1000)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="manak__benchmark__macros_8hpp.html#a37c0e143435c7c23afdda41fbbc0a689">MEASURE</a></div>
<div class="line">  (</div>
<div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0;i &lt; 1000;i++);</div>
<div class="line">  )</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="module__benchmark__case_8hpp.html#a57b66a0d95282c208124d1bdac0f8d2e">MANAK_AUTO_BENCHMARK_CASE</a>(ForLoops_2000)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="manak__benchmark__macros_8hpp.html#a37c0e143435c7c23afdda41fbbc0a689">MEASURE</a></div>
<div class="line">  (</div>
<div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0;i &lt; 200;i++);</div>
<div class="line">  )</div>
<div class="line">}</div>
</div><!-- fragment --><p>Parametrized benchmark cases in Manak helps reduce code duplication. The above code can be written like -</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> ForLoops(<span class="keywordtype">size_t</span> a)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="manak__benchmark__macros_8hpp.html#a37c0e143435c7c23afdda41fbbc0a689">MEASURE</a></div>
<div class="line">  (</div>
<div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0;i &lt; a;i++);</div>
<div class="line">  )</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="manak__macros_8hpp.html#a5a8f20b4fca604e483261aaf4f63e82c">MANAK_ADD_CASE</a>(<a class="code" href="module__benchmark__case_8hpp.html#adeade358344f5ac95e5b9c7a0cf166d2">MANAK_CREATE_BENCHMARK_WITH_TEMPLATE</a>(B1, ForLoops)-&gt;AddArgs(1000)-&gt;AddArgs(2000));</div>
</div><!-- fragment --><p>The output(HTML) can be seen <a href="samples/p_bench_1.html">HERE</a>. As you can see there are 2 sub-cases in B1. Notice that all the sub-cases share the same tolerance and iteration values.</p>
<p>Reducing code redundancy helps minimize errors. In the above code 'B1' is a parametrized benchmark holding 2 sets of parameter. With 'AddArgs' you can add more parameter sets to the parametrized benchmark. There can be any number of 'AddArgs' calls linked to a parametrized benchmark case. Parametrized benchmark case will run the given function on all the parameter sets. There is no restriction on type of function accepted by parametrized benchmark but number and type of parameters given to 'AddArgs' must match the given benchmark function. The only thing is that the auto template substitution won't work with functions. For templatized function the entire template signature must be provided.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><span class="keywordtype">int</span> fun(<span class="keyword">const</span> T&amp; t)</div>
<div class="line">{</div>
<div class="line">  Code;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="manak__macros_8hpp.html#a5a8f20b4fca604e483261aaf4f63e82c">MANAK_ADD_CASE</a>(<a class="code" href="module__benchmark__case_8hpp.html#adeade358344f5ac95e5b9c7a0cf166d2">MANAK_CREATE_BENCHMARK_WITH_TEMPLATE</a>(B1, fun&lt;std::string&gt;)-&gt;AddArgs(<span class="stringliteral">&quot;Test&quot;</span>));</div>
</div><!-- fragment --><p>Check out <a class="el" href="s_mod.html#s_mod_ar">Auto Registration</a> and <a class="el" href="n_mod.html#n_mod_ar">Auto Registration</a> for more supported parametrized benchmark macros with auto registration.</p>
<p>Check out <a class="el" href="s_mod.html#s_mod_mr">Manual Registration</a> and <a class="el" href="n_mod.html#n_mod_mr">Manual Registration with Normal Mode</a> for more supported parametrized benchmark macros with manual registration.</p>
<h1><a class="anchor" id="p_bench_aan"></a>
AddArgs_N</h1>
<p>'AddArgs' adds an unamed sub-case to the benchmark case. Sub-benchmark cases are characterized by the chronological index rather than a name. Check out <a class="el" href="mhierarchy.html#hierarchy_sub">Sub-Benchmark Case</a> for more information on the structure. But still it sometimes helps to associate it with a name. For example <a href="samples/p_bench_2.html">THIS</a> output is better than <a href="samples/p_bench_1.html">THIS</a> output. AddArgs_N can be used to add name to the sub-case.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> ForLoops(<span class="keywordtype">size_t</span> a)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="manak__benchmark__macros_8hpp.html#a37c0e143435c7c23afdda41fbbc0a689">MEASURE</a></div>
<div class="line">  (</div>
<div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0;i &lt; a;i++);</div>
<div class="line">  )</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="manak__macros_8hpp.html#a5a8f20b4fca604e483261aaf4f63e82c">MANAK_ADD_CASE</a>(<a class="code" href="module__benchmark__case_8hpp.html#adeade358344f5ac95e5b9c7a0cf166d2">MANAK_CREATE_BENCHMARK_WITH_TEMPLATE</a>(B1, ForLoops)-&gt;AddArgs_N(<span class="stringliteral">&quot;With 1000&quot;</span>, 1000)-&gt;AddArgs_N(<span class="stringliteral">&quot;With 2000&quot;</span>, 2000));</div>
</div><!-- fragment --><p>'AddArgs_N' works as same as AddArgs but always accepts first parameter as name. Remember even though name is added to the sub-case they are accessed only by their chronological index. To understand this better see <a class="el" href="mhierarchy.html#hierarchy_sub">Sub-Benchmark Case</a>.</p>
<h1><a class="anchor" id="p_bench_aca"></a>
AddCustomArgs</h1>
<p>If number of parameter sets gets large its inconvenient to write each one down in 'AddArgs'. On top of that they may be part of the sequence which can be generated at runtime. In this case 'AddCustomArgs' is useful.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> fun(<span class="keywordtype">int</span> a, <span class="keywordtype">int</span> b)</div>
<div class="line">{</div>
<div class="line">  Code;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">list&lt;tuple&lt;int, int&gt;&gt; GetArgs()</div>
<div class="line">{</div>
<div class="line">  list&lt;tuple&lt;int, int&gt;&gt; out;</div>
<div class="line">  <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0;i &lt; 50;i++)</div>
<div class="line">    out.emplace_back(i, i+1);</div>
<div class="line">  <span class="keywordflow">return</span> out;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="manak__macros_8hpp.html#a5a8f20b4fca604e483261aaf4f63e82c">MANAK_ADD_CASE</a>(<a class="code" href="module__benchmark__case_8hpp.html#adeade358344f5ac95e5b9c7a0cf166d2">MANAK_CREATE_BENCHMARK_WITH_TEMPLATE</a>(B1, fun)-&gt;AddCustomArgs(GetArgs));</div>
</div><!-- fragment --><p>'AddCustomArgs' accepts a function which should return list of appropriate tuples. This custom function can have parameters which can be passed to 'AddCustomArgs' after the function name.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> fun(<span class="keywordtype">int</span> a, <span class="keywordtype">int</span> b)</div>
<div class="line">{</div>
<div class="line">  Code;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">list&lt;tuple&lt;int, int&gt;&gt; GetArgs(<span class="keywordtype">int</span> a)</div>
<div class="line">{</div>
<div class="line">  list&lt;tuple&lt;int, int&gt;&gt; out;</div>
<div class="line">  <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0;i &lt; a;i++)</div>
<div class="line">    out.emplace_back(i, i+1);</div>
<div class="line">  <span class="keywordflow">return</span> out;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="manak__macros_8hpp.html#a5a8f20b4fca604e483261aaf4f63e82c">MANAK_ADD_CASE</a>(<a class="code" href="module__benchmark__case_8hpp.html#adeade358344f5ac95e5b9c7a0cf166d2">MANAK_CREATE_BENCHMARK_WITH_TEMPLATE</a>(B1, fun)-&gt;AddCustomArgs(GetArgs, 50));</div>
</div><!-- fragment --><p>To name sub-cases use AddCustomArgs_N.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> fun(<span class="keywordtype">int</span> a, <span class="keywordtype">int</span> b)</div>
<div class="line">{</div>
<div class="line">  Code;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">list&lt;tuple&lt;std::string, int, int&gt;&gt; GetArgs(<span class="keywordtype">int</span> a)</div>
<div class="line">{</div>
<div class="line">  list&lt;tuple&lt;int, int&gt;&gt; out;</div>
<div class="line">  <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0;i &lt; a;i++)</div>
<div class="line">    out.emplace_back(&lt;name&gt;, i, i+1);</div>
<div class="line">  <span class="keywordflow">return</span> out;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="manak__macros_8hpp.html#a5a8f20b4fca604e483261aaf4f63e82c">MANAK_ADD_CASE</a>(<a class="code" href="module__benchmark__case_8hpp.html#adeade358344f5ac95e5b9c7a0cf166d2">MANAK_CREATE_BENCHMARK_WITH_TEMPLATE</a>(B1, fun)-&gt;AddCustomArgs_N(GetArgs, 50));</div>
</div><!-- fragment --><p>For more advance function passing see <a class="el" href="use_afr.html">Advance Function Registration</a>.</p>
<p>Parametrized benchmark cases can also be used inside a group. for example -</p>
<div class="fragment"><div class="line"><a class="code" href="manak__macros_8hpp.html#a9b30113368385a684e82d86be646a2d7">MANAK_AUTO_GROUP</a>()</div>
<div class="line"></div>
<div class="line"><a class="code" href="manak__macros_8hpp.html#a3e0d091ad756bb53fdc8e4a7ffe5acce">GINIT</a>()</div>
<div class="line">{</div>
<div class="line"></div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> fun(<span class="keywordtype">size_t</span> a)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="manak__benchmark__macros_8hpp.html#a37c0e143435c7c23afdda41fbbc0a689">MEASURE</a></div>
<div class="line">  (</div>
<div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0;i &lt; 100;i++);</div>
<div class="line">  )</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="manak__macros_8hpp.html#aa7c700b921bb823e3a4ff55cff19de63">MANAK_ADD_TO_GROUP</a>(<a class="code" href="module__benchmark__case_8hpp.html#a04b828f51e0252234dc645e9a33710fa">MANAK_CREATE_GROUP_BENCHMARK_WITH_TEMPLATE</a>(<span class="stringliteral">&quot;InGroup&quot;</span>, fun)-&gt;AddArgs(100));</div>
<div class="line"></div>
<div class="line"><a class="code" href="manak__macros_8hpp.html#a7ec36c764e3ead2c9043199bdb7c71c5">MANAK_AUTO_GROUP_END</a>();</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Feb 5 2015 21:20:27 for Manak by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
