<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Manak: Tutorial on Using Groups</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Manak
   &#160;<span id="projectnumber">2.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('com_gr.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Tutorial on Using Groups </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>In Manak each case has its on scope and variables cannot be shared between them. Imagine a scenario in which you need to use a same variable in multiple cases and constructing that variable is very costly. What would you do? If you construct it in each case you would be wasting lot of resources. Manak provides a solution for this through groups.</p>
<p>Take a look at this example code -</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define MANAK_AUTO_MAIN</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define MANAK_INIT</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define MANAK_SIMPLE_MODULE</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><a class="code" href="manak__macros_8hpp.html#a9b30113368385a684e82d86be646a2d7">MANAK_AUTO_GROUP</a>();</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">size_t</span> num;</div>
<div class="line"></div>
<div class="line"><a class="code" href="manak__macros_8hpp.html#a3e0d091ad756bb53fdc8e4a7ffe5acce">GINIT</a>()</div>
<div class="line">{</div>
<div class="line">  num = 100;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="module__benchmark__case_8hpp.html#afecf2683d7fd06c9b4c8975191df59c0">MANAK_AUTO_GROUP_BENCHMARK_CASE</a>(<span class="stringliteral">&quot;B1&quot;</span>)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="manak__benchmark__macros_8hpp.html#a37c0e143435c7c23afdda41fbbc0a689">MEASURE</a></div>
<div class="line">  (</div>
<div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0;i &lt; num;i++);</div>
<div class="line">  )</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="manak__macros_8hpp.html#a7ec36c764e3ead2c9043199bdb7c71c5">MANAK_AUTO_GROUP_END</a>();</div>
</div><!-- fragment --><p>In the above code, all the cases inside the group share a variables defined inside the group. The function GINIT is the initialization function and is compulsory, but can be overloaded which we will see later. Group can be considered a class so variables can be defined anywhere in the group. The important thing to remember here is that the function 'GINIT' is not the constructor so the variables defined inside needs to be default constructible. But you can use pointers where you need to use non-default constructible objects. So for memory cleaning Manak provides 'GDOWN' function which can act as the destructor of the group.</p>
<p>Another importatnt thing is, group macros accepts string as the case name where other Manak macros accepts normal text. This has a very good reason behind it, which we will cover later.</p>
<div class="fragment"><div class="line"><a class="code" href="manak__macros_8hpp.html#a9b30113368385a684e82d86be646a2d7">MANAK_AUTO_GROUP</a>();</div>
<div class="line"></div>
<div class="line"><a class="code" href="manak__macros_8hpp.html#a3e0d091ad756bb53fdc8e4a7ffe5acce">GINIT</a>()</div>
<div class="line">{</div>
<div class="line"></div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="manak__macros_8hpp.html#af6e530cd4e19fcb66f07ada17f957f14">GDOWN</a>()</div>
<div class="line">{</div>
<div class="line"></div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="manak__macros_8hpp.html#a7ec36c764e3ead2c9043199bdb7c71c5">MANAK_AUTO_GROUP_END</a>();</div>
</div><!-- fragment --><p>The groups are invisible in the output. 'MANAK_AUTO_GROUP' registers all the registered cases to the group to the current suite. 'MANAK_AUTO_GROUP_BENCHMARK_CASE' registers the following case to the current group. Check out <a class="el" href="s_mod.html">Simple Benchmark Module</a> and <a class="el" href="n_mod.html">Normal Module</a> for more useful macros.</p>
<p>This is not all the groups are good for.</p>
<p>As we already know the 'GINIT' function can be used to initialize the variables defined in the group. These 'GINIT' functions can be overloaded and can have parameters. The 'MANAK_AUTO_GROUP' call the default '<a class="el" href="manak__macros_8hpp.html#a3e0d091ad756bb53fdc8e4a7ffe5acce">GINIT()</a>' function. To use overloaded 'GINIT' function we need to use define a group and then register it. This gives much more flexibility and power.</p>
<div class="fragment"><div class="line"><a class="code" href="manak__macros_8hpp.html#a41b5a5c7c25baeac43fdb2fd534906ed">MANAK_GROUP</a>(TestGroup);</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">size_t</span> n;</div>
<div class="line"></div>
<div class="line"><a class="code" href="manak__macros_8hpp.html#a3e0d091ad756bb53fdc8e4a7ffe5acce">GINIT</a>(<span class="keywordtype">size_t</span> x)</div>
<div class="line">{</div>
<div class="line">  n = x;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="manak__macros_8hpp.html#a3e0d091ad756bb53fdc8e4a7ffe5acce">GINIT</a>(<span class="keyword">const</span> std::string&amp; str)</div>
<div class="line">{</div>
<div class="line"></div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="module__benchmark__case_8hpp.html#afecf2683d7fd06c9b4c8975191df59c0">MANAK_AUTO_GROUP_BENCHMARK_CASE</a>(<span class="stringliteral">&quot;B1&quot;</span>)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="manak__benchmark__macros_8hpp.html#a37c0e143435c7c23afdda41fbbc0a689">MEASURE</a></div>
<div class="line">  (</div>
<div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0;i &lt; n;i++);</div>
<div class="line">  )</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="manak__macros_8hpp.html#afe8d8c18b2ff78ca468caf3ee3254187">MANAK_GROUP_END</a>();</div>
<div class="line"></div>
<div class="line"><a class="code" href="manak__macros_8hpp.html#a4fc4b895702281393159572745a2c679">MANAK_ADD_GROUP</a>(TestGroup, 1000);</div>
</div><!-- fragment --><p>'MANAK_ADD_GROUP' macro is pretty simple. The first argument is the group name and then you can pass the initialization arguments and it will call the appropriate 'GINIT' overload. 'MANAK_ADD_GROUP' will register all the cases inside the group to current benchmark suite.</p>
<p>Now you will ask can I add a group multiple times with different initializations??</p>
<p>Yes you can, but before showing how I would like you to see another important property of groups - they can be templatized.</p>
<p>So the above can also be written as -</p>
<div class="fragment"><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><a class="code" href="manak__macros_8hpp.html#a41b5a5c7c25baeac43fdb2fd534906ed">MANAK_GROUP</a>(TestGroup);</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">size_t</span> n;</div>
<div class="line"></div>
<div class="line"><a class="code" href="manak__macros_8hpp.html#a3e0d091ad756bb53fdc8e4a7ffe5acce">GINIT</a>(T x)</div>
<div class="line">{</div>
<div class="line">  n = x;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="module__benchmark__case_8hpp.html#afecf2683d7fd06c9b4c8975191df59c0">MANAK_AUTO_GROUP_BENCHMARK_CASE</a>(<span class="stringliteral">&quot;B1&quot;</span>)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="manak__benchmark__macros_8hpp.html#a37c0e143435c7c23afdda41fbbc0a689">MEASURE</a></div>
<div class="line">  (</div>
<div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0;i &lt; n;i++);</div>
<div class="line">  )</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="manak__macros_8hpp.html#afe8d8c18b2ff78ca468caf3ee3254187">MANAK_GROUP_END</a>();</div>
<div class="line"></div>
<div class="line"><a class="code" href="manak__macros_8hpp.html#a4fc4b895702281393159572745a2c679">MANAK_ADD_GROUP</a>(TestGroup&lt;size_t&gt;, 1000);</div>
</div><!-- fragment --><p>They can also be template specialized, partially and completely.</p>
<p>Okay, now lets try to add the same group multiple times with different initializations.</p>
<div class="fragment"><div class="line"><a class="code" href="manak__macros_8hpp.html#a41b5a5c7c25baeac43fdb2fd534906ed">MANAK_GROUP</a>(TestGroup);</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">size_t</span> n;</div>
<div class="line"></div>
<div class="line"><a class="code" href="manak__macros_8hpp.html#a3e0d091ad756bb53fdc8e4a7ffe5acce">GINIT</a>(<span class="keywordtype">size_t</span> x)</div>
<div class="line">{</div>
<div class="line">  n = x;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="manak__macros_8hpp.html#a3e0d091ad756bb53fdc8e4a7ffe5acce">GINIT</a>(<span class="keyword">const</span> std::string&amp; str)</div>
<div class="line">{</div>
<div class="line"></div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="module__benchmark__case_8hpp.html#afecf2683d7fd06c9b4c8975191df59c0">MANAK_AUTO_GROUP_BENCHMARK_CASE</a>(<span class="stringliteral">&quot;B1&quot;</span>)</div>
<div class="line">{</div>
<div class="line">  std::cout &lt;&lt; n &lt;&lt; std::endl;</div>
<div class="line">  <a class="code" href="manak__benchmark__macros_8hpp.html#a37c0e143435c7c23afdda41fbbc0a689">MEASURE</a></div>
<div class="line">  (</div>
<div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0;i &lt; n;i++);</div>
<div class="line">  )</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="manak__macros_8hpp.html#afe8d8c18b2ff78ca468caf3ee3254187">MANAK_GROUP_END</a>();</div>
<div class="line"></div>
<div class="line"><a class="code" href="manak__macros_8hpp.html#a4fc4b895702281393159572745a2c679">MANAK_ADD_GROUP</a>(TestGroup, 1000);</div>
<div class="line"><a class="code" href="manak__macros_8hpp.html#a4fc4b895702281393159572745a2c679">MANAK_ADD_GROUP</a>(TestGroup, 10000);</div>
</div><!-- fragment --><p>Compile and run this code and you will see this error while running - </p>
<div class="fragment"><div class="line">Contains multiple entries <span class="keywordflow">for</span> library with <span class="keywordflow">case</span> B1.</div>
<div class="line">@endode</div>
<div class="line"></div>
<div class="line">This is because when you are adding the same group multiple times benchmark <span class="keywordflow">case</span></div>
<div class="line"><span class="stringliteral">&quot;B1&quot;</span> is also added multiple times under same suite. This is why the group benchmark</div>
<div class="line">macros accept a <span class="keywordtype">string</span> rather than text so you can provide the variable.</div>
<div class="line">For example - </div>
<div class="line"></div>
<div class="line">@code</div>
<div class="line"><a class="code" href="manak__macros_8hpp.html#a41b5a5c7c25baeac43fdb2fd534906ed">MANAK_GROUP</a>(TestGroup);</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">size_t</span> n;</div>
<div class="line">std::string name;</div>
<div class="line"></div>
<div class="line"><a class="code" href="manak__macros_8hpp.html#a3e0d091ad756bb53fdc8e4a7ffe5acce">GINIT</a>(<span class="keywordtype">size_t</span> x, <span class="keyword">const</span> std::string&amp; str)</div>
<div class="line">{</div>
<div class="line">  n = x;</div>
<div class="line">  name = str;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="manak__macros_8hpp.html#a3e0d091ad756bb53fdc8e4a7ffe5acce">GINIT</a>(<span class="keyword">const</span> std::string&amp; str)</div>
<div class="line">{</div>
<div class="line">  n = 1000;</div>
<div class="line">  name = str;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="module__benchmark__case_8hpp.html#afecf2683d7fd06c9b4c8975191df59c0">MANAK_AUTO_GROUP_BENCHMARK_CASE</a>(name)</div>
<div class="line">{</div>
<div class="line">  std::cout &lt;&lt; n &lt;&lt; std::endl;</div>
<div class="line">  <a class="code" href="manak__benchmark__macros_8hpp.html#a37c0e143435c7c23afdda41fbbc0a689">MEASURE</a></div>
<div class="line">  (</div>
<div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0;i &lt; n;i++);</div>
<div class="line">  )</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="manak__macros_8hpp.html#afe8d8c18b2ff78ca468caf3ee3254187">MANAK_GROUP_END</a>();</div>
<div class="line"></div>
<div class="line"><a class="code" href="manak__macros_8hpp.html#a4fc4b895702281393159572745a2c679">MANAK_ADD_GROUP</a>(TestGroup, 1000, <span class="stringliteral">&quot;With1000&quot;</span>);</div>
<div class="line"><a class="code" href="manak__macros_8hpp.html#a4fc4b895702281393159572745a2c679">MANAK_ADD_GROUP</a>(TestGroup, 10000, <span class="stringliteral">&quot;With10000&quot;</span>);</div>
</div><!-- fragment --><p>Here we added another parameter to 'GINIT' which determines the name of the case inside it. This way 2 different benchmark cases will be registered. Or is it so? Let's see. As we have put the value of 'n' to std::cout we can check the logs to make sure. It you are using the default configuration the logs can be seen in file 'benchmark_log.txt'. This file is appended so check the last couple of lines, and you will see that only 10000 is printed 20 times. The expected output is 1000, 10 times and 10000, 10 times isn't it? So what went wrong this time?</p>
<p>Each group instance is unique, hence each group can be assigned only one initilization. When we add the same group twice with different initialization, all initialization are called on the same instance.</p>
<p>So how do we add a same group multiple times with different initializations? The solution is through templates. As we know that each template substitution is a different instance, we can templatize the group we want to add multiple times, and add it with different template substitutions.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span>&lt;<span class="keywordtype">size_t</span> index&gt;</div>
<div class="line"><a class="code" href="manak__macros_8hpp.html#a41b5a5c7c25baeac43fdb2fd534906ed">MANAK_GROUP</a>(TestGroup);</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">size_t</span> n;</div>
<div class="line">std::string name;</div>
<div class="line"></div>
<div class="line"><a class="code" href="manak__macros_8hpp.html#a3e0d091ad756bb53fdc8e4a7ffe5acce">GINIT</a>(<span class="keywordtype">size_t</span> x, <span class="keyword">const</span> std::string&amp; str)</div>
<div class="line">{</div>
<div class="line">  n = x;</div>
<div class="line">  name = str;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="manak__macros_8hpp.html#a3e0d091ad756bb53fdc8e4a7ffe5acce">GINIT</a>(<span class="keyword">const</span> std::string&amp; str)</div>
<div class="line">{</div>
<div class="line">  n = 1000;</div>
<div class="line">  name = str;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="module__benchmark__case_8hpp.html#afecf2683d7fd06c9b4c8975191df59c0">MANAK_AUTO_GROUP_BENCHMARK_CASE</a>(name)</div>
<div class="line">{</div>
<div class="line">  std::cout &lt;&lt; n &lt;&lt; std::endl;</div>
<div class="line">  <a class="code" href="manak__benchmark__macros_8hpp.html#a37c0e143435c7c23afdda41fbbc0a689">MEASURE</a></div>
<div class="line">  (</div>
<div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0;i &lt; n;i++);</div>
<div class="line">  )</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="manak__macros_8hpp.html#afe8d8c18b2ff78ca468caf3ee3254187">MANAK_GROUP_END</a>();</div>
<div class="line"></div>
<div class="line"><a class="code" href="manak__macros_8hpp.html#a4fc4b895702281393159572745a2c679">MANAK_ADD_GROUP</a>(TestGroup&lt;1&gt;, 1000, <span class="stringliteral">&quot;With1000&quot;</span>);</div>
<div class="line"><a class="code" href="manak__macros_8hpp.html#a4fc4b895702281393159572745a2c679">MANAK_ADD_GROUP</a>(TestGroup&lt;2&gt;, 10000, <span class="stringliteral">&quot;With10000&quot;</span>);</div>
</div><!-- fragment --><p>Check the log again, 10 times 1000 and 10 times 10000. Voila!!! You have added the same group with different initializations. Imagine the amount of code redundancy which can be removed.</p>
<p>Lets take a scenario of machine learning benchmarking. Lets assume algorithm1 and algorithm2 for same goal that you want to compare against and check. They are implemented in class Algo1 and Algo2, assuming they have the same API, the following code can be used.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define MANAK_MODULE bench</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define MANAK_AUTO_MAIN </span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define MANAK_INIT</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="manak_8hpp.html">manak/manak.hpp</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><a class="code" href="manak__macros_8hpp.html#a41b5a5c7c25baeac43fdb2fd534906ed">MANAK_GROUP</a>(TheGoal);</div>
<div class="line"></div>
<div class="line"><a class="code" href="manak__macros_8hpp.html#a3e0d091ad756bb53fdc8e4a7ffe5acce">GINIT</a>()</div>
<div class="line">{</div>
<div class="line">  </div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="module__benchmark__case_8hpp.html#afecf2683d7fd06c9b4c8975191df59c0">MANAK_AUTO_GROUP_BENCHMARK_CASE</a>(<span class="stringliteral">&quot;The Goal&quot;</span>, T::GetTypeName())</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="manak__benchmark__macros_8hpp.html#a37c0e143435c7c23afdda41fbbc0a689">MEASURE</a></div>
<div class="line">  (</div>
<div class="line">    <span class="comment">// Code to benchmark</span></div>
<div class="line">  )</div>
<div class="line">  </div>
<div class="line">  <a class="code" href="test__macros_8hpp.html#a92717f0a23da76e5499d59c7587df54d">TEST</a></div>
<div class="line">  (</div>
<div class="line">    <span class="comment">// Tests to run on output</span></div>
<div class="line">  )</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="manak__macros_8hpp.html#afe8d8c18b2ff78ca468caf3ee3254187">MANAK_GROUP_END</a>();</div>
<div class="line"></div>
<div class="line"><a class="code" href="manak__macros_8hpp.html#a4fc4b895702281393159572745a2c679">MANAK_ADD_GROUP</a>(TheGoal&lt;Algo1&gt;);</div>
<div class="line"><a class="code" href="manak__macros_8hpp.html#a4fc4b895702281393159572745a2c679">MANAK_ADD_GROUP</a>(TheGoal&lt;Algo2&gt;);</div>
</div><!-- fragment --><p>In the above code we have used the algorithm name as a library name so that in the output they can be compared horizontally. Check out <a class="el" href="comp.html">Comparison Framework</a> to know more about this comparison framework. Check out <a class="el" href="s_mod.html">Simple Benchmark Module</a> and <a class="el" href="n_mod.html">Normal Module</a> for macros provided for group benchmark registration. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Feb 5 2015 21:20:27 for Manak by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
